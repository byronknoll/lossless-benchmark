<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet"
              href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
              integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
              crossorigin="anonymous">
        <title>lossless-benchmark</title>
    </head>
    <body>
        <div class="container" style="max-width: 90%;">
            <h1>enwik8 &amp; enwik9</h1>
            <div>
                Rules:
                <ul>
                    <li>
                        Results must be publicly verifiable. Compression programs must be free for personal use without
                        expiration date (no trialware) and without registration. Publishing benchmark results must not
                        be prohibited in program license.
                    </li>
                    <li>
                        By default programs are ranked by compressed enwik9 size + decompressor size. Decompressor size
                        may be based on publicly available source code (if it exists) or executable size. Decompressor
                        itself may be compressed to .7z format using LZMA compression.
                    </li>
                    <li>
                        Decompressor must be self-contained. It must not rely on any data that is not contained in
                        decompressor package. Any libraries that are not available in stock OS install must also be
                        placed in decompressor package.
                    </li>
                </ul>
            </div>
            <form>
                <div class="row">
                    <div class="col form-group">
                        <label for="enwik_shown_series">Show compressor series</label>
                        <select multiple class="form-control" id="enwik_shown_series">
                            <!--filled in script-->
                        </select>
                    </div>
                    <div class="col form-group">
                        <label for="enwik_expanded_series">Show only first result in series</label>
                        <select multiple class="form-control" id="enwik_collapsed_series">
                            <!--filled in script-->
                        </select>
                    </div>
                </div>
                <div class="row">
                    <label for="enwik_results_dump" class="col-sm-2 col-form-label">Raw JSON dump</label>
                    <div class="col-sm-10">
                        <input type="text" readonly class="form-control-plaintext" id="enwik_results_dump">
                    </div>
                </div>
            </form>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th class="border-bottom-0 pb-0 text-left">Compression program</th>
                        <th class="border-bottom-0 pb-0 text-left">Options</th>
                        <th class="border-bottom-0 pb-0 text-center" colspan="2">Compressed size</th>
                        <th class="border-bottom-0 pb-0 text-right">Decompressor size (7z)</th>
                        <th class="border-bottom-0 pb-0 text-right" style="font-size: 1.25rem;">Total size</th>
                        <th class="border-bottom-0 pb-0 text-center" colspan="2">Time (ns/byte)</th>
                        <th class="border-bottom-0 pb-0 text-right">Mem</th>
                        <th class="border-bottom-0 pb-0 text-left">Alg</th>
                        <th class="border-bottom-0 pb-0 text-right">Note</th>
                    </tr>
                    <tr>
                        <th class="border-top-0 pt-0" colspan="2"></th>
                        <th class="border-top-0 pt-0 text-right" id="enwik8_size_column">enwik8</th>
                        <th class="border-top-0 pt-0 text-right" id="enwik9_size_column">enwik9</th>
                        <th class="border-top-0 pt-0"></th>
                        <th class="border-top-0 pt-0 text-right" id="enwik_total_size_column">enwik9 + prog</th>
                        <th class="border-top-0 pt-0 text-right">Comp</th>
                        <th class="border-top-0 pt-0 text-right">Decomp</th>
                        <th class="border-top-0 pt-0" colspan="3"></th>
                    </tr>
                </thead>
                <tbody id="enwik_results_body"><!--filled in script--></tbody>
            </table>
            <h3>Notes</h3>
            <ol>
                <li id="note-1">
                    Reported by Darek on May 9, 2018. System: Core i7 4900MQ at 3.8GHz, 32GB, Win7Pro 64.
                </li>
            </ol>
        </div>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
                integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
                integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
        <script type="text/javascript">
            "use strict";
            function enwik_result(program_name,
                    program_options,
                    compressed_enwik8_size,
                    compressed_enwik9_size,
                    decompressor_size,
                    total_compressed_size,
                    compression_time,
                    decompression_time,
                    memory_usage_in_mb,
                    algorithm_type,
                    note_id) {
                return {
                    program_name: program_name,
                    program_options: program_options,
                    compressed_enwik8_size: compressed_enwik8_size,
                    compressed_enwik9_size: compressed_enwik9_size,
                    decompressor_size: decompressor_size,
                    total_compressed_size: total_compressed_size,
                    compression_time: compression_time,
                    decompression_time: decompression_time,
                    memory_usage_in_mb: memory_usage_in_mb,
                    algorithm_type: algorithm_type,
                    note_id: note_id
                };
            }
            // enwik results begin
            var enwik_results_by_series = {};
            enwik_results_by_series['CMV'] = [
                enwik_result(
                        "CMV v00.01.01", "-m2,3,0x03ed7dfb",
                        "18,122,372", "149,357,765", "78,922", "149,436,687",
                        "426,163", "394,855", "3,335", "CM", "1")
            ];
            enwik_results_by_series['PAQ'] = [
                enwik_result(
                        "Paq8pxd_v47_3", "-s15",
                        "16,038,418", "126,749,584", "150,210", "126,899,794",
                        "83,435", "86,671", "27,600", "CM", "1")
            ];
            enwik_results_by_series['fake'] = [
                enwik_result(
                        "fake v1", "--fast",
                        "93,123,123", "923,123,123",
                        "123,123", "923,246,246",
                        "23,456", "23,456", "1,234", "FAKE", "0"),
                enwik_result(
                        "fake v1", "--test",
                        "3,123,123", "23,123,123",
                        "123,123", "23,246,246",
                        "823,456", "823,456", "81,234", "FAKE", "0"),
                enwik_result(
                        "fake v1", "--best",
                        "20,000,000", "100,000,000", "123,123", "100,123,123",
                        "123,456", "123,456", "12,345", "FAKE", "0")
            ];
            // enwik results end
            $("#enwik_results_dump").val(JSON.stringify(enwik_results_by_series));
            var enwik_sorted_columns_by_field = {
                compressed_enwik8_size: "enwik8_size_column",
                compressed_enwik9_size: "enwik9_size_column",
                total_compressed_size: "enwik_total_size_column"
            };
            $.each(enwik_sorted_columns_by_field, function (field_name) {
                var column_name = enwik_sorted_columns_by_field[field_name];
                $("#" + column_name).click(function () {
                    fill_enwik_table(field_name);
                });
            });
            var shown_series_selector = $("#enwik_shown_series");
            var collapsed_series_selector = $("#enwik_collapsed_series");
            for (var results_key in enwik_results_by_series) {
                shown_series_selector.append("<option selected=\"selected\">" + results_key + "</option>");
            }
            shown_series_selector.change(function () {
                collapsed_series_selector.empty();
                collapsed_series_selector.append("<option></option>");
                $(this).find("option").each(function () {
                    if ($(this).prop("selected")) {
                        collapsed_series_selector.append("<option selected=\"selected\">" + $(this).val() +
                                "</option>");
                    }
                });
                fill_enwik_table();
            });
            shown_series_selector.change();
            collapsed_series_selector.change(function () {
                fill_enwik_table();
            });
            function fill_enwik_table(sorted_column) {
                sorted_column = sorted_column || "total_compressed_size";
                for (var field_name in enwik_sorted_columns_by_field) {
                    var column_id = enwik_sorted_columns_by_field[field_name];
                    if (field_name === sorted_column) {
                        $("#" + column_id).css("text-decoration", "underline");
                    } else {
                        $("#" + column_id).css("text-decoration", "");
                    }
                }
                var results_to_show = new Set();
                shown_series_selector.find("option").each(function () {
                    if ($(this).prop("selected")) {
                        results_to_show.add($(this).val());
                    }
                });
                var results_to_collapse = new Set();
                collapsed_series_selector.find("option").each(function () {
                    if ($(this).prop("selected")) {
                        results_to_collapse.add($(this).val());
                    }
                });
                var enwik_results = [];
                for (var results_key in enwik_results_by_series) {
                    if (results_to_show.has(results_key)) {
                        var results = enwik_results_by_series[results_key];
                        if (results_to_collapse.has(results_key)) {
                            enwik_results.push(results[0]);
                        } else {
                            for (var result of results) {
                                enwik_results.push(result);
                            }
                        }
                    }
                }
                enwik_results.sort(function (a, b) {
                    if (a[sorted_column].length !== b[sorted_column].length) {
                        return a[sorted_column].length - b[sorted_column].length;
                    } else {
                        return a[sorted_column] === b[sorted_column] ? 0 :
                                a[sorted_column] < b[sorted_column] ? -1 : 1;
                    }
                });
                var body = $("#enwik_results_body");
                body.empty();
                for (var index = 0; index < enwik_results.length; index++) {
                    var result = enwik_results[index];
                    var row = $("<tr></tr>");
                    row.append("<td class=\"text-left\">" + result.program_name + "</td>");
                    row.append("<td class=\"text-left\">" + result.program_options + "</td>");
                    row.append("<td class=\"text-right\">" + result.compressed_enwik8_size + "</td>");
                    row.append("<td class=\"text-right\">" + result.compressed_enwik9_size + "</td>");
                    row.append("<td class=\"text-right\">" + result.decompressor_size + "</td>");
                    row.append("<td class=\"text-right\">" + result.total_compressed_size + "</td>");
                    row.append("<td class=\"text-right\">" + result.compression_time + "</td>");
                    row.append("<td class=\"text-right\">" + result.decompression_time + "</td>");
                    row.append("<td class=\"text-right\">" + result.memory_usage_in_mb + "</td>");
                    row.append("<td class=\"text-left\">" + result.algorithm_type + "</td>");
                    row.append("<td class=\"text-right\"><a href=\"#note-" + result.note_id + "\">" + result.note_id +
                            "</a></td>");
                    body.append(row);
                }
            }
            fill_enwik_table();
        </script>
    </body>
</html>
